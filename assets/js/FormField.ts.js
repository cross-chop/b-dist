class o extends HTMLElement{input=null;inputs=[];errorElement=null;isMulti=!1;observer=null;passwordToggle=null;isPasswordVisible=!1;confirmPasswordId="";confirmErrorMessage="";hasConfirmFieldBlurred=!1;simplePasswordValidation=!1;connectedCallback(){this.isMulti=this.hasAttribute("data-multi"),this.errorElement=this.querySelector(".error"),this.confirmPasswordId=this.getAttribute("data-confirm-password")||"",this.confirmErrorMessage=this.getAttribute("data-confirm-error-message")||"パスワードが一致しません",this.simplePasswordValidation=this.hasAttribute("data-simple-password-validation"),this.isMulti?(this.inputs=Array.from(this.querySelectorAll("input, textarea, select")),this.inputs.forEach(t=>{this.setupValidationForInput(t),t.tagName==="SELECT"&&this.updateSelectPlaceholderState(t)})):(this.input=this.querySelector("input, textarea, select"),this.input&&(this.setupValidation(),this.input.tagName==="SELECT"&&this.updateSelectPlaceholderState(this.input))),this.setupValueChangeObserver(),this.setupPasswordToggle(),this.setupPasswordConfirmValidation()}disconnectedCallback(){this.observer&&this.observer.disconnect()}setupValueChangeObserver(){this.observer=new MutationObserver(t=>{t.forEach(e=>{e.type==="attributes"&&e.attributeName==="value"&&this.handleExternalValueChange()})}),this.isMulti?this.inputs.forEach(t=>{this.observer?.observe(t,{attributes:!0,attributeFilter:["value"]}),t.addEventListener("change",()=>this.handleExternalValueChange())}):this.input&&(this.observer?.observe(this.input,{attributes:!0,attributeFilter:["value"]}),this.input.addEventListener("change",()=>this.handleExternalValueChange()))}handleExternalValueChange(){this.errorElement?.style.display==="block"&&this.hideError()}setupValidationForInput(t){const e=t.tagName==="SELECT";e?t.addEventListener("change",()=>{this.validateMulti()}):t.addEventListener("blur",()=>{this.validateMulti()}),t.addEventListener("input",()=>{this.errorElement?.style.display==="block"&&this.hideError()}),e&&t.addEventListener("change",()=>{this.errorElement?.style.display==="block"&&this.hideError(),this.updateSelectPlaceholderState(t)})}setupValidation(){const t=this.input?.tagName==="SELECT";t?this.input?.addEventListener("change",()=>{this.validate()}):this.input?.addEventListener("blur",()=>{this.validate()}),this.input?.addEventListener("input",()=>{this.errorElement?.style.display==="block"&&this.hideError()}),t&&this.input?.addEventListener("change",()=>{this.errorElement?.style.display==="block"&&this.hideError(),this.updateSelectPlaceholderState()})}updateSelectPlaceholderState(t){t||this.input}validateMulti(){if(!this.errorElement||this.hasAttribute("disabled")||!this.inputs.some(s=>s.hasAttribute("required")))return!0;if(!this.inputs.every(s=>s.value.trim()!=="")){const s=this.errorElement.dataset.requiredError||"入力してください";return this.showError(s),!1}return this.hideError(),!0}validate(){if(this.isMulti)return this.validateMulti();if(this.hasAttribute("data-checkbox")||this.hasAttribute("disabled")||!this.input||!this.errorElement||this.input.hasAttribute("disabled"))return!0;const e=this.input.value,s=this.input.hasAttribute("required"),r=this.input.dataset.fieldType||this.input.type;if(s&&!e.trim()){const i=this.errorElement.dataset.requiredError||"入力してください";return this.showError(i),!1}if(r==="email"&&e.trim()&&!this.validateEmail(e)){const i=this.errorElement.dataset.validationError||"正しいメールアドレスを入力してください";return this.showError(i),!1}if(r==="postal"&&e.trim()&&!this.validatePostalCode(e)){const i=this.errorElement.dataset.validationError||"郵便番号は数字のみまたは数字とハイフン（-）、長音符（ー）のみ入力してください";return this.showError(i),!1}if(r==="phone"&&e.trim()&&!this.validatePhone(e)){const i=this.errorElement.dataset.validationError||"電話番号は数字とハイフン（-）、長音符（ー）、スペースのみ入力してください";return this.showError(i),!1}if(r==="password"&&e.trim()&&!this.simplePasswordValidation){const i=this.validatePasswordStrength(e);if(!i.isValid)return this.showError(i.errorMessage),!1}return this.hideError(),!0}validateEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}validatePostalCode(t){return/^[0-9０-９\-ー]+$/.test(t)}validatePassword(t){return/^[\x20-\x7E]+$/.test(t)}validatePasswordStrength(t){if(t.length<15)return{isValid:!1,errorMessage:"パスワードが短すぎます（15文字以上にしてください）"};if(!/^[A-Za-z0-9!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]+$/.test(t)){const n=this.getInvalidCharacters(t);if(n.length>0)return{isValid:!1,errorMessage:`「${n.join(", ")}」はパスワードに使用できない文字です。`}}const s=/[A-Z]/.test(t),r=/[a-z]/.test(t),i=/[0-9]/.test(t),a=/[!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]/.test(t),l=[];return s||l.push("英大文字"),r||l.push("英小文字"),i||l.push("数字"),a||l.push("記号"),l.length>0?{isValid:!1,errorMessage:`${l.join("・")}を1つ以上含めてください`}:{isValid:!0,errorMessage:""}}getInvalidCharacters(t){const e=/[A-Za-z0-9!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]/,s=[],r=new Set;for(let i=0;i<t.length;i++){const a=t[i];!e.test(a)&&!r.has(a)&&(s.push(a),r.add(a))}return s}validatePhone(t){return/^[0-9０-９\-ー\s　]+$/.test(t)}showError(t){this.errorElement&&(this.errorElement.textContent=t,this.errorElement.style.display="block"),this.isMulti?this.inputs.forEach(e=>{e.classList.add("has-error")}):this.input&&this.input.classList.add("has-error")}hideError(){this.errorElement&&(this.errorElement.style.display="none"),this.isMulti?this.inputs.forEach(t=>{t.classList.remove("has-error")}):this.input&&this.input.classList.remove("has-error")}getValue(){return this.input?.value||""}getName(){return this.input?.name||""}setValue(t){this.isMulti?this.inputs.forEach(e=>{e.value=t}):this.input&&(this.input.value=t),this.errorElement?.style.display==="block"&&this.hideError()}triggerValidation(){this.isMulti?this.validateMulti():this.validate()}setupPasswordToggle(){this.passwordToggle=this.querySelector(".password-toggle"),this.passwordToggle&&this.input&&this.input.getAttribute("type")==="password"&&this.passwordToggle.addEventListener("click",()=>{this.togglePasswordVisibility()})}setupPasswordConfirmValidation(){if(!this.confirmPasswordId||!this.input)return;const t=document.getElementById(this.confirmPasswordId);t&&(this.input.addEventListener("blur",()=>{this.hasConfirmFieldBlurred=!0,this.validatePasswordConfirm()}),this.input.addEventListener("input",()=>{this.hasConfirmFieldBlurred&&this.validatePasswordConfirm()}),t.addEventListener("input",()=>{this.hasConfirmFieldBlurred&&this.validatePasswordConfirm()}),t.addEventListener("blur",()=>{this.hasConfirmFieldBlurred&&this.validatePasswordConfirm()}))}validatePasswordConfirm(){if(!this.confirmPasswordId||!this.input)return!0;const t=document.getElementById(this.confirmPasswordId);if(!t)return!0;const e=this.input.value,s=t.value;return!e&&!s?(this.hideError(),!0):e!==s?(this.showError(this.confirmErrorMessage),!1):(this.hideError(),!0)}togglePasswordVisibility(){!this.input||this.input.getAttribute("type")!=="password"&&this.input.getAttribute("type")!=="text"||(this.isPasswordVisible=!this.isPasswordVisible,this.isPasswordVisible?this.input.setAttribute("type","text"):this.input.setAttribute("type","password"),this.passwordToggle&&this.passwordToggle.setAttribute("data-visible",this.isPasswordVisible.toString()))}}customElements.define("form-field",o);
