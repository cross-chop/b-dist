document.addEventListener("DOMContentLoaded",()=>{const r=document.querySelector(".FormrunSender");if(!r)return;const i=r.querySelector("#form-input"),s=r.querySelector("#form-confirm"),f=r.querySelector("#form-thanks");if(!i||!s||!f){console.error("フォーム要素が見つかりません");return}const u=r.querySelectorAll("form-field");function h(){let e=!0;return u.forEach(n=>{n.validate&&!n.validate()&&(e=!1)}),e}function o(e){const n=r.querySelector("#form-error");switch(i.style.display="none",s.style.display="none",f.style.display="none",n&&(n.style.display="none"),e){case"input":i.style.display="flex";break;case"confirm":s.style.display="flex";break;case"thanks":f.style.display="flex";break;case"error":n&&(n.style.display="flex");break}}function k(){const e=s.querySelector(".confirm-fields");e&&(e.innerHTML="",u.forEach(n=>{const l=n.querySelector("label")?.cloneNode(!0),t=document.createElement("div");t.className="FormField",l&&t.appendChild(l);const c=document.createElement("div");c.className="confirm-text",c.textContent=n.getValue?n.getValue():"",t.appendChild(c),e.appendChild(t)}))}function a(e){return r.querySelector(`#${e}`)}const m=a("confirm-btn"),d=a("back-btn"),p=a("submit-btn"),y=a("home-btn");m&&m.addEventListener("click",e=>{e.preventDefault(),h()&&(k(),o("confirm"))}),d&&d.addEventListener("click",e=>{e.preventDefault(),o("input")}),p&&p.addEventListener("click",e=>{e.preventDefault();const n=new FormData;u.forEach(t=>{const c=t.getName?t.getName():"",v=t.getValue?t.getValue():"";c&&n.append(c,v)});const l=r.dataset.submitUrl;if(!l){console.error("送信先URLが設定されていません"),alert("送信先の設定に問題があります。");return}console.log("フォーム送信開始:",Object.fromEntries(n)),fetch(l,{method:"POST",mode:"cors",body:n}).then(t=>{t.status>=200&&t.status<400?(console.log(`送信完了: ステータスコード ${t.status}`),o("thanks")):(console.error(`送信エラー: ステータスコード ${t.status}`),o("error"))}).catch(t=>{console.error("送信エラー:",t),o("error")})}),y&&y.addEventListener("click",e=>{e.preventDefault(),window.location.href="/"});const b=a("error-back-btn");b&&b.addEventListener("click",e=>{e.preventDefault(),o("input")})});
