document.addEventListener("DOMContentLoaded",()=>{const n=document.querySelector(".FormrunSender");if(!n)return;const i=n.querySelector("#form-input"),s=n.querySelector("#form-confirm"),f=n.querySelector("#form-thanks");if(!i||!s||!f){console.error("フォーム要素が見つかりません");return}const u=n.querySelectorAll("form-field");function h(){let e=!0;return u.forEach(r=>{r.validate&&!r.validate()&&(e=!1)}),e}function o(e){i.style.display="none",s.style.display="none",f.style.display="none";const r=n.querySelector("#form-error");switch(e){case"input":i.style.display="flex";break;case"confirm":s.style.display="flex";break;case"thanks":f.style.display="flex";break;case"error":r&&(r.style.display="flex");break}}function k(){const e=s.querySelector(".confirm-fields");e&&(e.innerHTML="",u.forEach(r=>{const l=r.querySelector("label")?.cloneNode(!0),t=document.createElement("div");t.className="FormField",l&&t.appendChild(l);const c=document.createElement("div");c.className="confirm-text",c.textContent=r.getValue?r.getValue():"",t.appendChild(c),e.appendChild(t)}))}function a(e){return n.querySelector(`#${e}`)}const m=a("confirm-btn"),d=a("back-btn"),p=a("submit-btn"),y=a("home-btn");m&&m.addEventListener("click",e=>{e.preventDefault(),h()&&(k(),o("confirm"))}),d&&d.addEventListener("click",e=>{e.preventDefault(),o("input")}),p&&p.addEventListener("click",e=>{e.preventDefault();const r=new FormData;u.forEach(t=>{const c=t.getName?t.getName():"",v=t.getValue?t.getValue():"";c&&r.append(c,v)});const l=n.dataset.submitUrl;if(!l){console.error("送信先URLが設定されていません"),alert("送信先の設定に問題があります。");return}console.log("フォーム送信開始:",Object.fromEntries(r)),fetch(l,{method:"POST",mode:"cors",body:r}).then(t=>{t.status>=200&&t.status<400?(console.log(`送信完了: ステータスコード ${t.status}`),o("thanks")):(console.error(`送信エラー: ステータスコード ${t.status}`),o("error"))}).catch(t=>{console.error("送信エラー:",t),o("error")})}),y&&y.addEventListener("click",e=>{e.preventDefault(),window.location.href="/"});const b=a("error-back-btn");b&&b.addEventListener("click",e=>{e.preventDefault(),o("input")})});
