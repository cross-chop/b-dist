document.addEventListener("DOMContentLoaded",()=>{const o=document.querySelector(".FormrunSender");if(!o)return;const s=o.querySelector("#form-input"),a=o.querySelector("#form-confirm"),f=o.querySelector("#form-thanks");if(!s||!a||!f){console.error("フォーム要素が見つかりません");return}const m=o.querySelectorAll("form-field");function h(){let e=!0;return m.forEach(n=>{n.validate&&!n.validate()&&(e=!1)}),e}function l(e){switch(s.style.display="none",a.style.display="none",f.style.display="none",e){case"input":s.style.display="flex";break;case"confirm":a.style.display="flex";break;case"thanks":f.style.display="flex";break}}function b(){const e=a.querySelector(".confirm-fields");e&&(e.innerHTML="",m.forEach(n=>{const c=n.querySelector("label")?.cloneNode(!0),t=document.createElement("div");t.className="FormField",c&&t.appendChild(c);const r=document.createElement("div");r.className="confirm-text",r.textContent=n.getValue?n.getValue():"",t.appendChild(r),e.appendChild(t)}))}function i(e){return o.querySelector(`#${e}`)}const u=i("confirm-btn"),d=i("back-btn"),p=i("submit-btn"),y=i("home-btn");u&&u.addEventListener("click",e=>{e.preventDefault(),h()&&(b(),l("confirm"))}),d&&d.addEventListener("click",e=>{e.preventDefault(),l("input")}),p&&p.addEventListener("click",e=>{e.preventDefault();const n=new FormData;m.forEach(t=>{const r=t.getName?t.getName():"",v=t.getValue?t.getValue():"";r&&n.append(r,v)});const c=o.dataset.submitUrl;if(!c){console.error("送信先URLが設定されていません"),alert("送信先の設定に問題があります。");return}console.log("フォーム送信開始:",Object.fromEntries(n)),fetch(c,{method:"POST",mode:"cors",body:n}).then(()=>{console.log("送信完了"),l("thanks")}).catch(t=>{console.error("送信エラー:",t),l("thanks")})}),y&&y.addEventListener("click",e=>{e.preventDefault(),window.location.href="/"})});
