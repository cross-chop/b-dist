import{g as t}from"./index.js";import{S as p}from"./ScrollTrigger.js";import{M as u}from"./MorphSVGPlugin.js";import{l}from"./lottie.js";t.registerPlugin(u,p);window.onpageshow=function(h){h.persisted&&window.location.reload()};class d{stepNumber;stepTotal;indicatorBar;finish;progress;total;constructor(e,s){this.stepNumber=e.querySelector(".stepNumber"),this.stepTotal=e.querySelector(".stepTotal"),this.indicatorBar=e.querySelector(".indicatorBar"),this.finish=e.querySelector(".finish"),this.progress=e.querySelector(".progress"),this.total=s,this.setStepTotal(s-1)}update(e){this.setStepNumber(e),this.setIndicatorBar(e),e===this.total?(t.set(this.finish,{display:"block"}),t.set(this.progress,{display:"none"})):(t.set(this.finish,{display:"none"}),t.set(this.progress,{display:"block"}))}setStepNumber(e){this.stepNumber.textContent=e.toString()}setStepTotal(e){this.stepTotal.textContent=e.toString()}setIndicatorBar(e){t.to(this.indicatorBar,{scaleX:e/this.total,duration:.5,ease:"power1.out"})}}class f{base;tl;baseColor;colors;parent;eye;eyePosition;el;eye1;eye2;eye3;eye4;eye5;eye6;eyes;constructor(e,s,i){this.el=e,this.parent=i,this.base=e.querySelector(".base"),this.baseColor="#ffffff",this.colors=[["#ffffff","#ffffff"],["#ffffff","#ffffff"],["#FAEEE6","#FAEEE6"],["#F0E5DF","#F0E5DF"],["#E8D7CE","#E8D7CE"],["#E1CABE","#E1CABE"],["#D9BDAE","#D9BDAE"],["#D1BEB5","#DCBCB0"],["#C9BFBB","#E0BBB1"],["#C1C0C2","#E3BAB3"],["#B9C1C8","#E6B9B5"],["#B1C3CF","#EAB9B7"],["#A8C4D6","#EDB8B8"],["#A0C5DC","#F0B7BA"],["#98C6E3","#F3B6BC"],["#90C7E9","#F7B5BD"],["#88C8F0","#FAB4BF"]],this.eye=e.querySelector(".eye"),this.eyePosition=[[[86.4647,18.6437],[86.4647,18.6437]],[[86.4647,18.6437],[86.4647,18.6437]],[[109.3015,14.5063],[109.3015,14.5063]],[[85.2983,22.5095],[85.2983,22.5095]],[[108.8682,14.5095],[108.8682,14.5095]],[[97.3057,37.9563],[97.3057,37.9563]],[[109.2983,14.5095],[109.2983,14.5095]],[[125.3057,59.5063],[125.3057,59.5063]],[[37.2983,49.3655],[37.2983,49.3655]],[[53.2983,41.3655],[53.2983,41.3655]],[[130.2983,65.3655],[130.2983,65.3655]],[[108.022,66.5099],[108.022,66.5099]],[[117.2983,10.49],[117.2983,10.49]],[[72.29,85.51],[72.29,85.51]],[[92,35.8733],[44.32,31.49]],[[85,37.0049],[84,37]],[[86,20.4846],[124.34,27.97]]],this.eyes=e.querySelectorAll(".eye > div"),this.eye1=l.loadAnimation({container:this.eye.querySelector(".eye1"),renderer:"svg",loop:!1,autoplay:!1,path:"/assets/lottie/type-check/01_bebo_eyes_open.json"}),this.eye2=l.loadAnimation({container:this.eye.querySelector(".eye2"),renderer:"svg",loop:!1,autoplay:!1,path:"/assets/lottie/type-check/03_bebo_eyes_beside.json"}),this.eye3=l.loadAnimation({container:this.eye.querySelector(".eye3"),renderer:"svg",loop:!1,autoplay:!1,path:"/assets/lottie/type-check/04_bebo_eyes_vertical.json"}),this.eye4=l.loadAnimation({container:this.eye.querySelector(".eye4"),renderer:"svg",loop:!1,autoplay:!1,path:"/assets/lottie/type-check/05_bebo_eyes_downwardrotation.json"}),this.eye5=l.loadAnimation({container:this.eye.querySelector(".eye5"),renderer:"svg",loop:!1,autoplay:!1,path:"/assets/lottie/type-check/06_bebo_eyes_toprotation.json"}),this.eye1.onComplete=async()=>{this.eyeLoop()},this.eye2.onComplete=async()=>{t.set(this.eyes,{opacity:0}),t.set(this.eyes[0],{opacity:1}),await t.delayedCall(.1,()=>{}),this.eye1.goToAndPlay(0,!0)},this.eye3.onComplete=async()=>{t.set(this.eyes,{opacity:0}),t.set(this.eyes[0],{opacity:1}),await t.delayedCall(.1,()=>{}),this.eye1.goToAndPlay(0,!0)},this.eye4.onComplete=async()=>{t.set(this.eyes,{opacity:0}),t.set(this.eyes[0],{opacity:1}),await t.delayedCall(.1,()=>{}),this.eye1.goToAndPlay(0,!0)},this.eye5.onComplete=async()=>{t.set(this.eyes,{opacity:0}),t.set(this.eyes[0],{opacity:1}),await t.delayedCall(.1,()=>{}),this.eye1.goToAndPlay(0,!0)},t.set(this.eyes,{opacity:0})}eyeLoop(){t.set(this.eyes,{opacity:0});const e=t.utils.random(1,5,1);e===1?(this.eye1.goToAndPlay(0,!0),t.set(this.eyes[1],{opacity:1})):e===2?(this.eye2.goToAndPlay(0,!0),t.set(this.eyes[1],{opacity:1})):e===3?(this.eye3.goToAndPlay(0,!0),t.set(this.eyes[2],{opacity:1})):e===4?(this.eye4.goToAndPlay(0,!0),t.set(this.eyes[3],{opacity:1})):e===5&&(this.eye5.goToAndPlay(0,!0),t.set(this.eyes[4],{opacity:1}))}loop(e,s){this.tl=t.timeline({repeat:-1,defaults:{duration:.8,ease:"none"}}).to(this.base,{morphSVG:{shape:`#chara_q${e}_${s}_2`}}).to(this.base,{morphSVG:{shape:`#chara_q${e}_${s}_3`}}).to(this.base,{morphSVG:{shape:`#chara_q${e}_${s}_4`}}).to(this.base,{morphSVG:{shape:`#chara_q${e}_${s}_3`}}).to(this.base,{morphSVG:{shape:`#chara_q${e}_${s}_2`}}).to(this.base,{morphSVG:{shape:`#chara_q${e}_${s}_1`}})}async change(e,s){this.tl.pause(),this.tl.kill(),t.to(this.eye,{left:this.eyePosition[e-1][s][0]/200*100+"%",top:this.eyePosition[e-1][s][1]/120*100+"%",duration:.8,ease:"power1.inOut"}),t.to(this,{baseColor:this.colors[e-1][s],duration:.5,ease:"none",onUpdate:()=>{this.parent.style.setProperty("--type-check-shape-color",this.baseColor)}}),e===2&&(t.set(this.eyes[0],{opacity:1}),this.eye1.goToAndPlay(0,!0));const i=e<=14?0:s;await t.to(this.base,{morphSVG:{shape:`#chara_q${e}_${i}_1`},duration:.5,ease:"none"}),this.loop(e,i)}}class S{el;id;tl;titleNumber;titleText;btns;constructor(e,s){this.el=e,this.id=s+1,this.titleNumber=e.querySelector(".title .number"),this.titleText=e.querySelector(".title .text"),this.btns=e.querySelectorAll(".btn"),this.tl=t.timeline({paused:!0}).set(this.el,{autoAlpha:1,pointerEvents:"auto"}).fromTo([this.titleNumber,this.titleText],{opacity:0,y:20},{opacity:1,y:0,duration:.4,stagger:.08,ease:"power1.out"}),this.btns.length>0&&this.tl.fromTo(this.btns,{opacity:0,y:20},{opacity:1,y:0,stagger:.08,duration:.4,ease:"power1.out"})}show(){this.tl.play(0)}hide(){t.to(this.el,{autoAlpha:0,duration:.4,ease:"none"})}}class g extends HTMLElement{inner;currentStep;header;btnChangeStep;character;textColors;characterType;textColor;questions;question;prevBtn;isClickable;scores;scoreDisplay;currentType;typeLabel;constructor(){super(),this.inner=this.querySelector(".inner");const s=new URLSearchParams(window.location.search).get("q");this.currentStep=s?parseInt(s):1,this.questions=this.querySelectorAll(".question"),this.question=[],this.questions.forEach((o,r)=>{this.question.push(new S(o,r))}),this.isClickable=!0,this.scores=[0,0,0],this.scoreDisplay=null,this.header=new d(this.querySelector(".header"),this.questions.length),this.character=new f(this.querySelector(".character"),this.questions.length,this),this.characterType=0,this.currentType=0,this.typeLabel=["弛緩性","けいれん性","直腸性"],this.textColor="#505153",this.textColors=[["#505153","#505153"],["#505153","#505153"],["#625E5E","#625E5E"],["#746C69","#746C69"],["#857973","#857973"],["#97877E","#97877E"],["#A99489","#A99489"],["#A3958F","#AB938A"],["#9E9694","#AE928B"],["#98989A","#B0918C"],["#91979E","#B2908E"],["#8999A2","#B5908F"],["#8398A7","#B78F90"],["#7C99AA","#B98E92"],["#7599AF","#BB8E93"],["#6F98B2","#BE8D93"],["#6999B7","#C08C95"]],this.question[this.currentStep-1].show(),this.header.update(this.currentStep),this.character.loop(this.currentStep,0),this.btnChangeStep=this.querySelectorAll(".btnChangeStep"),this.btnChangeStep.forEach(o=>{o.addEventListener("click",async()=>{this.isClickable&&(this.changeStep(1),t.delayedCall(.1,()=>{this.isClickable=!1}))})}),this.prevBtn=this.querySelector(".btnPrev"),this.prevBtn.addEventListener("click",()=>{this.isClickable&&(this.changeStep(-1),t.delayedCall(.1,()=>{this.isClickable=!1}))}),this.querySelectorAll(".btnGroup").forEach(o=>{const r=o.querySelectorAll(".Btn");r.forEach(n=>{n.addEventListener("click",()=>{if(!this.isClickable)return;const c=n.closest(".btn");o.querySelectorAll(".btn").forEach(y=>{y.classList.remove("isActive")}),r.forEach(y=>{y.classList.remove("isActive")}),n.classList.add("isActive"),c&&c.classList.add("isActive"),this.checkQ1Progress(),this.currentStep>=7&&this.updateScores()})})});const a=this.querySelectorAll(".btnsShape .Btn");a.forEach(o=>{const r=o.querySelector(".frame"),n=t.timeline({paused:!0});n.to(r,{scale:1.04,duration:.2,ease:"power1.out"}).to(r,{scale:1,duration:.3,ease:"bounce.out"}),o.addEventListener("mouseenter",()=>n.restart()),o.addEventListener("click",()=>{this.isClickable&&(a.forEach(c=>{c.classList.remove("isActive")}),o.classList.add("isActive"))})})}async changeStep(e){if(await t.delayedCall(.4,()=>{}),this.question[this.currentStep-1].hide(),await t.delayedCall(.4,()=>{}),this.currentStep===3&&e===1){const s=this.querySelector('[data-question-id="3"].isActive'),i=this.querySelector('[data-question-id="2"].isActive');if(s&&i){const a=s.getAttribute("data-is-no-consitipation")==="true";if(i.getAttribute("data-is-no-consitipation")==="true"&&a){window.location.href="/type-check/result/no-constipation/";return}}}if((this.currentStep===4||this.currentStep===5)&&e===1){const s=this.querySelector(`[data-question-id="${this.currentStep}"].isActive`);if(s&&s.getAttribute("data-is-warning-symptom")==="true"){window.location.href="/type-check/result/warning-symptoms/";return}}if(this.currentStep===6&&e===1){const s=this.querySelector(`[data-question-id="${this.currentStep}"].isActive`);if(s&&s.getAttribute("data-is-warning-medication")==="true"){window.location.href="/type-check/result/warning-medication/";return}}this.currentStep=this.currentStep+e,t.to(this,{textColor:this.textColors[this.currentStep-1][this.characterType],duration:.5,ease:"none",onUpdate:()=>{this.style.setProperty("--type-check-text-color",this.textColor)}}),this.question[this.currentStep-1].show(),this.header.update(this.currentStep),this.character.change(this.currentStep,this.characterType),this.currentStep===this.questions.length&&t.timeline({onComplete:async()=>{await t.delayedCall(2,()=>{this.typeLabel[this.currentType]==="弛緩性"?window.location.href="/type-check/result/atonic-constipation/":this.typeLabel[this.currentType]==="けいれん性"?window.location.href="/type-check/result/spastic-constipation/":this.typeLabel[this.currentType]==="直腸性"&&(window.location.href="/type-check/result/rectal-constipation/")})}}).to([this.character.el,".nowLoading"],{y:window.innerWidth>1024?50:100,duration:1,ease:"power1.inOut"}),this.currentStep===1||this.currentStep===this.questions.length?this.prevBtn.classList.add("isDisabled"):this.prevBtn.classList.remove("isDisabled"),this.isClickable=!0}async checkQ1Progress(){if(this.currentStep!==1)return;const e=this.querySelector(".Q1 .gender .Btn.isActive"),s=this.querySelector(".Q1 .ages .Btn.isActive");e&&s&&(this.isClickable=!1,this.changeStep(1),await t.delayedCall(1.5,()=>{this.isClickable=!0}))}updateScores(){this.scores=[0,0,0];const e=this.querySelectorAll(".btn.isActive[data-points]"),s=Array.from(e).filter(i=>parseInt(i.getAttribute("data-question-id")||"0")>=7);console.log("全アクティブなボタン数:",e.length),console.log("Q7以降のアクティブなボタン数:",s.length),s.forEach((i,a)=>{const o=i.getAttribute("data-points");if(console.log(`ボタン${a+1} - data-points:`,o),o)try{const r=JSON.parse(o);console.log(`ボタン${a+1} - パース結果:`,r),Array.isArray(r)&&r.forEach((n,c)=>{c<this.scores.length&&(this.scores[c]+=n,console.log(`スコア[${c}] に ${n} を追加 -> 合計: ${this.scores[c]}`))})}catch(r){console.warn("ポイントデータの解析に失敗しました:",o,r)}}),this.updateCharacterType(),this.updateScoreDisplay()}updateCharacterType(){const e=Math.max(...this.scores);if(e===0){this.currentType=0;return}this.scores.indexOf(e);const s=this.scores.map((i,a)=>({score:i,index:a})).filter(i=>i.score===e).map(i=>i.index);this.currentType=s[0],this.characterType=this.currentType===2?0:this.currentType}updateScoreDisplay(){const e=[this.querySelector(".score-0"),this.querySelector(".score-1"),this.querySelector(".score-2")],s=this.querySelector(".current-type");e.forEach((i,a)=>{i&&(i.textContent=this.scores[a].toString())}),s&&(s.textContent=this.typeLabel[this.currentType]||"判定中")}getScores(){return{scores:this.scores,characterType:this.characterType,currentType:this.currentType,totalQuestions:this.scores.reduce((e,s)=>e+s,0)}}}customElements.define("type-check",g);
